<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <style>
        .error {
            font-size: 10px;
            color: red;
            height: 15px;
        }

        .borderError {
            border: solid 2px red;
        }

        .submiteButton {
            margin: 10px 0px 10px 20px;
            height: 25px;
            width: 100px;
            font-size: 15px;
            background: green;
            color: white;
        }

        .buttonEdit {
            width: 250px;
            margin-bottom: 10px;
            margin-top: 10px;
            font-size: 15px;
            color: red;
            border: solid 2px black;
        }

        .buttonSave {
            width: 250px;
            margin-top: 10px;
            margin-bottom: 10px;
            color: white;
            font-size: 15px;
            background: green;
            border: solid 2px black;
        }

        .blockNone {
            display: none;
        }

        .buttonDescription {
            margin: '10px 10px 20px 20px';
            width: 250px;
            border: solid 2px black;
            font-size: 15px;
            color: green;
        }

        .buttonDelete {
            width: 250px;
            color: white;
            background: red;
            border: solid 2px black;
        }

        .cheapStyle {
            width: 250px;
            margin-top: 5px;
            margin-bottom: 5px;
            padding: 5px 5px 5px 5px;
            border: solid 4px grey;
        }

        .optimalStyle {
            width: 250px;
            margin-top: 5px;
            margin-bottom: 5px;
            padding: 5px 5px 5px 5px;
            border: solid 4px green;
        }

        .premiumStyle {
            width: 250px;
            margin-top: 5px;
            margin-bottom: 5px;
            padding: 5px 5px 5px 5px;
            border: solid 4px orange;
        }

        .cardsContainer {
            padding-left: 40%;
        }

        .mainForm {
            padding-left: 20%;
            padding-right: 20%;
        }

        .popup {
            position: absolute;
            margin-left: 300px;
        }
    </style>

    <script>
        'use strict';

        const model = [{
                picture: "https://clck.ru/NLWJA",
                name: 'DDDDD',
                article: 'A12',
                count: 88,
                price: 100,
                creationDate: new Date().toLocaleDateString(),
                priceSegment: 'cheap',
                description: null,
            },

            {
                picture: null,
                name: 'BBBBB',
                article: 'A23',
                count: 185,
                price: 110,
                creationDate: new Date().toLocaleDateString(),
                priceSegment: 'cheap',
                description: [
                    `wwwwwwww wwwwwwwwww wwww`
                ],
            },

            {
                picture: "https://clck.ru/NLWJA",
                name: 'CCCCC',
                article: 'A33',
                count: 77,
                price: 120,
                creationDate: new Date().toLocaleDateString(),
                priceSegment: 'optimal',
                description: [
                    `wwwwwwww wwwwwwwwww wwww`
                ],
            },

            {
                picture: null,
                name: 'AAAAA',
                article: 'A48',
                count: 1,
                price: 130,
                creationDate: new Date().toLocaleDateString(),
                priceSegment: 'premium',
                description: null,
            },

            {
                picture: "https://clck.ru/NLWJA",
                name: 'EEEEE',
                article: 'A57',
                count: 1,
                price: 140,
                creationDate: new Date().toLocaleDateString(),
                priceSegment: 'premium',
                description: null,
            },
        ];

        const clearForm = (form) => {
            for (let input of form.elements) {
                if (input.type === 'submit') continue;
                input.value = '';
                formData.picture = '';
                formData.nameInput = '';
                formData.articleInput = '';
                formData.countInput = '';
                formData.praceInput = '';
                formData.dateInput = '';
                formData.checkbox = '';
                formData.description = '';
            };
        };

        const clearSegmentFilter = (segmentFilter) => {
            for (let input of segmentFilter.elements) {
                formData.isCheap = '';
                formData.isOptimal = '';
                formData.isPremium = '';
            };
        };

        const appendElement = (position, htmlElemnt, id = null) => {
            const elem = document.createElement(htmlElemnt);
            elem.id = id;
            position.append(elem);
        };

        const appendInput = (form, type, id, labelText) => {
            const inputContainer = document.createElement('div');

            const input = document.createElement('input');
            input.setAttribute('type', type);
            input.id = id;

            if (labelText) {
                const labelTextForInput = document.createElement('labelText');
                labelTextForInput.setAttribute('for', id);
                labelTextForInput.innerText = labelText;
                inputContainer.append(labelTextForInput);
            };
            inputContainer.append(input);

            const arrorContainer = document.createElement('div');
            arrorContainer.classList.add('error');
            inputContainer.append(arrorContainer);

            form.append(inputContainer);
        };

        appendElement(document.body, 'div', 'content');

        appendElement(content, 'form', 'mainForm');
        mainForm.classList.add('mainForm');

        appendElement(content, 'div', 'cardsContainer');
        cardsContainer.classList.add('cardsContainer');

        appendElement(mainForm, 'fieldSet', 'mainInfo');
        appendElement(mainInfo, 'legend');
        mainInfo.children[0].innerText = 'Main information';

        appendInput(mainInfo, 'text', 'nameInput', 'Name');
        nameInput.placeholder = 'Product';
        nameInput.required = 'true';

        appendInput(mainInfo, 'text', 'articleInput', 'Article');
        articleInput.placeholder = 'A12';
        articleInput.required = 'true';

        appendInput(mainInfo, 'number', 'countInput', 'Сount');
        countInput.placeholder = '1...';
        countInput.min = '1';
        countInput.required = 'true';

        appendInput(mainInfo, 'number', 'praceInput', 'Price');
        praceInput.placeholder = 'number';
        praceInput.min = '1';
        praceInput.required = 'true';

        appendInput(mainInfo, 'date', 'dateInput', 'Creation date');
        dateInput.required = 'true';

        appendElement(mainForm, 'fieldSet', 'priceSegment');
        appendElement(priceSegment, 'legend');
        priceSegment.children[0].innerText = 'Price segment';

        appendInput(priceSegment, 'radio', 'cheap', 'Cheap');
        cheap.setAttribute('checked', 'true');
        cheap.name = 'priceSegment';
        cheap.required = 'true';

        appendInput(priceSegment, 'radio', 'optimal', 'Optimal');
        optimal.name = 'priceSegment';

        appendInput(priceSegment, 'radio', 'premium', 'Premium');
        premium.name = 'priceSegment';

        appendElement(mainForm, 'fieldSet', 'secondaryInfo');
        appendElement(secondaryInfo, 'legend');
        secondaryInfo.children[0].innerText = 'Secondary information';

        appendInput(secondaryInfo, 'text', 'picture', 'Picture');
        picture.placeholder = "https://clck.ru/NLWJA";

        appendElement(secondaryInfo, 'div', 'lebelForDesc');
        lebelForDesc.innerText = 'Description';

        appendElement(secondaryInfo, 'textarea', 'description');

        appendElement(mainForm, 'button', 'submitButton');
        submitButton.innerText = 'Submit';
        submitButton.classList.add('submiteButton');

        appendElement(mainForm, 'form', 'searchForm');
        appendElement(searchForm, 'fieldSet', 'search');
        appendElement(search, 'legend');
        search.children[0].innerText = 'Search';
        appendInput(search, 'text', 'searchInput', 'Search product');

        appendElement(searchForm, 'fieldSet', 'segmentFilter');
        appendElement(segmentFilter, 'legend');
        segmentFilter.children[0].innerText = 'Filter by price segment';

        appendInput(segmentFilter, 'checkbox', 'isCheap', 'Cheap');
        isCheap.setAttribute('checked', 'true');
        appendInput(segmentFilter, 'checkbox', 'isOptimal', 'Optimal');
        isOptimal.setAttribute('checked', 'true');
        appendInput(segmentFilter, 'checkbox', 'isPremium', 'Premium');
        isPremium.setAttribute('checked', 'true');

        appendElement(searchForm, 'fieldSet', 'sortBy');
        appendElement(sortBy, 'legend');
        sortBy.children[0].innerText = 'Sort by';

        appendInput(sortBy, 'radio', 'byAlphabet', 'Alphabet');
        byAlphabet.name = 'sortBy';
        appendInput(sortBy, 'radio', 'byPrice', 'Price');
        byPrice.name = 'sortBy';
        appendInput(sortBy, 'radio', 'byCount', 'Count');
        byCount.name = 'sortBy';
        appendInput(sortBy, 'radio', 'byDate', 'Date');
        byDate.name = 'sortBy';

        // Validation

        nameInput.addEventListener('change', event => {
            if (event.target.value.length < 5) {
                nameInput.parentElement.children[2].innerText =
                    'The name must contain more five characters';
                nameInput.classList.add('borderError');
            } else {
                nameInput.parentElement.children[2].innerText = '';
                nameInput.classList.remove('borderError');
            };
        });

        articleInput.addEventListener('change', event => {
            let splitArticleInput = event.target.value.split('');
            if (splitArticleInput[0] > 'Z' || isNaN(splitArticleInput[1]) || isNaN(splitArticleInput[2])) {
                articleInput.parentElement.children[2].innerText =
                    '"Article" must begin with a single uppercase letter, and further contain at least two digits.';
            } else {
                articleInput.parentElement.children[2].innerText = '';
            };
        });

        praceInput.addEventListener('change', event => {
            if (isNaN(event.target.value)) {
                praceInput.parentElement.children[2].innerText =
                    'The "number" should not have a value less than one;';
            } else {
                praceInput.parentElement.children[2].innerText = '';
            };
        });

        let formData = {};

        let inputObject = {};

        function addInputInFormData(form) {
            for (let input of form.elements) {
                if (input.type === 'submit') continue
                if (input.type === 'radio') {
                    input.addEventListener('change', event => {
                        formData[input.id] = event.target.checked;
                    });
                    continue
                };

                input.addEventListener('change', event => {
                    formData[input.id] = event.target.value;
                    inputObject.picture = formData.picture;
                    inputObject.name = formData.nameInput;
                    inputObject.article = formData.articleInput;
                    inputObject.count = formData.countInput;
                    inputObject.price = formData.praceInput;
                    inputObject.date = formData.dateInput;
                    inputObject.description = formData.description;

                    function getValueRadio() {
                        let cheapId = document.getElementById('cheap');
                        let optimalId = document.getElementById('optimal');
                        let premiumId = document.getElementById('premium');

                        if (cheapId.checked) {
                            inputObject.priceSegment = 'cheap';
                        }
                        if (optimalId.checked) {
                            inputObject.priceSegment = 'optimal';
                        }
                        if (premiumId.checked) {
                            inputObject.priceSegment = 'premium';
                        }
                    };
                    getValueRadio()
                });
            };
            return inputObject;
        };
        addInputInFormData(mainInfo);
        addInputInFormData(priceSegment);
        addInputInFormData(secondaryInfo);

        let setView = (arr = model) => {

            cardsContainer.innerHTML = '';

            for (let item of arr) {
                let elementContainer = document.createElement('div');
                let namePicture = document.createElement('div');
                if (item.picture === null || item.picture === undefined || item.picture === '') {
                    namePicture.innerHTML = 'No image'
                } else {
                    namePicture.innerHTML = `<image src = ${item.picture} height = 150px width = 250px>`
                };
                elementContainer.append(namePicture);

                let nameContainer = document.createElement('div');
                nameContainer.innerHTML = `Name: ${item.name}`
                elementContainer.append(nameContainer);

                let nameArticle = document.createElement('div');
                nameArticle.innerHTML = `Article: ${item.article}`
                elementContainer.append(nameArticle);

                let nameCount = document.createElement('div');
                if (item.count === 1) {
                    nameCount.innerHTML = `Count: <i><b>1 Last one<b/></i>`;
                    nameCount.style.color = 'red';
                } else {
                    nameCount.innerHTML = `Count: ${item.count}`
                };

                elementContainer.append(nameCount);

                let namePrice = document.createElement('div');
                namePrice.innerHTML = `Price: ${item.price}`
                elementContainer.append(namePrice);

                let nameDate = document.createElement('div');
                if (item.creationDate === new Date().toLocaleDateString()) {
                    nameDate.innerHTML = `Date: ${item.creationDate}`
                } else {
                    nameDate.innerHTML = `Date: ${formData.dateInput}`
                };
                elementContainer.append(nameDate);

                const editButton = document.createElement('input');
                editButton.type = 'button';
                editButton.value = 'Edit'
                editButton.classList.add('buttonEdit');
                elementContainer.append(editButton);

                editButton.addEventListener('click', (event) => {

                    editButton.classList.toggle('blockNone');

                    const popup = document.createElement('div');
                    if (item.priceSegment === 'cheap') popup.classList.add('cheapStyle');
                    if (item.priceSegment === 'optimal') popup.classList.add('optimalStyle');
                    if (item.priceSegment === 'premium') popup.classList.add('premiumStyle');
                    popup.classList.add('popup');
                    cardsContainer.prepend(popup);

                    appendInput(popup, 'text', 'changeLink', 'img link');
                    changeLink.placeholder = 'https://clck.ru/NLWJA';
                    appendInput(popup, 'text', 'changeName', 'Name');
                    changeName.placeholder = 'At least 5 characters';
                    appendInput(popup, 'text', 'changeArticle', 'Article');
                    changeArticle.placeholder = 'A23';
                    appendInput(popup, 'number', 'changeCount', 'Count');
                    changeCount.placeholder = 'number';
                    changeCount.min = '1';
                    appendInput(popup, 'number', 'changePrice', 'Price');
                    changePrice.placeholder = 'number';

                    const buttonSave = document.createElement('button');
                    buttonSave.classList.add('buttonSave');
                    buttonSave.innerText = 'Save';
                    popup.append(buttonSave);

                    const buttonDelete = document.createElement('button');
                    buttonDelete.classList.add('buttonDelete');
                    buttonDelete.innerText = 'Delete';
                    popup.append(buttonDelete);

                    const buttonCollectionAllPopup = popup.querySelectorAll('button');
                    const buttonSavePopup = buttonCollectionAllPopup[0];
                    const buttonDelitePopup = buttonCollectionAllPopup[1];

                    buttonDelitePopup.addEventListener('click', function () {
                        popup.remove();
                        elementContainer.remove();
                    });

                    changeLink.value = item.picture;
                    changeName.value = item.name;
                    changeArticle.value = item.article;
                    changeCount.value = item.count;
                    changePrice.value = item.count;

                    changeName.addEventListener('input', (event) => {
                        let changeNameEnter = event.target.value.length;
                        if (changeNameEnter < 5) {
                            changeName.parentElement.children[2].innerText =
                                'At least 5 characters';
                            buttonSavePopup.setAttribute('disabled', 'true');
                            changeName.classList.add('borderError');
                        } else {
                            changeName.parentElement.children[2].innerText = '';
                            changeName.innerText = '';
                            changeName.classList.remove('borderError');
                            buttonSavePopup.removeAttribute('disabled');
                        };
                    });

                    changeArticle.addEventListener('change', event => {
                        let changeArticleEnter = event.target.value.split('');
                        if (changeArticleEnter[0] > 'Z' || isNaN(changeArticleEnter[1]) || isNaN(
                                changeArticleEnter[2])) {
                            changeArticle.parentElement.children[2].innerText = 'Input format A23';
                            buttonSavePopup.setAttribute('disabled', 'true');
                            changeArticle.classList.add('borderError');
                        } else {
                            changeArticle.parentElement.children[2].innerText = '';
                            changeArticle.innerText = '';
                            changeArticle.classList.remove('borderError');
                            buttonSavePopup.removeAttribute('disabled');
                        };
                    });

                    changeCount.addEventListener('change', event => {
                        let changeCountEnter = event.target.value.split('');
                        let resultOfChecking = changeCount.value % 1 == 0 ? 'целое' : 'дробное';
                        if (resultOfChecking === 'дробное') {
                            changeCount.parentElement.children[2].innerText = 'Enter an integer';
                            buttonSavePopup.setAttribute('disabled', 'true');
                            changeCount.classList.add('borderError');
                        } else {
                            changeCount.parentElement.children[2].innerText = '';
                            changeCount.innerText = '';
                            changeCount.classList.remove('borderError');
                            buttonSavePopup.removeAttribute('disabled');
                        };
                    });

                    buttonSavePopup.addEventListener('click', function () {
                        item.picture = changeLink.value;
                        item.name = changeName.value;
                        item.article = changeArticle.value;
                        item.count = changeCount.value;
                        item.count = changePrice.value;
                        setView();
                    });
                });

                if (item.priceSegment === 'cheap') elementContainer.classList.add('cheapStyle');
                if (item.priceSegment === 'optimal') elementContainer.classList.add('optimalStyle');
                if (item.priceSegment === 'premium') elementContainer.classList.add('premiumStyle');

                cardsContainer.append(elementContainer);
                document.body.append(cardsContainer);

                let contentDescription = document.createElement('div');
                if (item.description === null || item.description === undefined) {
                    contentDescription.innerHTML = '';
                } else {
                    contentDescription.innerHTML = `Description: <i>${item.description}</i>`

                    let buttonDescription = document.createElement('button');
                    buttonDescription.innerText = 'Description';
                    buttonDescription.classList.add('buttonDescription');
                    elementContainer.append(buttonDescription);

                    buttonDescription.onclick = function () {
                        elementContainer.append(contentDescription);
                        contentDescription.classList.toggle('blockNone');
                    };
                };
            };
        };

        let getCheckboxValues = () => {
            let checkboxValues = {};
            for (let item of segmentFilter.elements) {
                checkboxValues[item.id] = item.checked;
            };
            return checkboxValues
        };

        // Filtration-Sort-Search

        for (let item of segmentFilter.elements) {
            item.addEventListener('input', (event) => {
                let checkboxState = getCheckboxValues(segmentFilter);
                if (checkboxState.isCheap && checkboxState.isOptimal && checkboxState.isPremium) {
                    setView();
                } else {
                    let filteredCards = model.filter(item => {
                        return ((checkboxState.isCheap ? item.priceSegment == 'cheap' :
                                false) ||
                            (checkboxState.isOptimal ? item.priceSegment == 'optimal' :
                                false) ||
                            (checkboxState.isPremium ? item.priceSegment == 'premium' :
                                false))
                    });
                    setView(filteredCards);

                    for (let item of sortBy.elements) {
                        item.addEventListener('change', (event) => {

                            if (byAlphabet.checked) {
                                const output = filteredCards.sort((a, b) => {
                                    return a.name > b.name ? 1 : -1
                                });
                                setView(output);
                            };

                            if (byPrice.checked) {
                                const output = filteredCards.sort((a, b) => {
                                    return b.price - a.price
                                });
                                setView(output);
                            };

                            if (byCount.checked) {
                                const output = filteredCards.sort((a, b) => {
                                    return b.count - a.count
                                });
                                setView(output);
                            };

                            if (byDate.checked) {
                                const output = filteredCards.sort((a, b) => {
                                    a = new Date(a.dateInput);
                                    b = new Date(b.dateInput);
                                    if (a < b)
                                        return -1
                                });
                                setView(output);
                            };
                        });
                    };
                    searchInput.addEventListener('input', (event) => {
                        const filteredListArray = filteredCards.filter(item => {
                            return item.name.toLowerCase().startsWith(event.target.value
                                .toLowerCase());
                        });
                        setView(filteredListArray);
                    });
                };
            });
        };

        setView(model);

        mainForm.addEventListener('submit', (event) => {
            event.preventDefault();

            model.unshift(inputObject);
            inputObject = {};

            setView(model);
            clearForm(event.target);
        });
    </script>
</body>

</html>